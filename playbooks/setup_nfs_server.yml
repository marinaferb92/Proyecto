- hosts: nfs_server
  become: yes
  vars_files:
    - ../vars/variables.yml

  tasks:
    - name: Instalar NFS server
      apt:
        name: nfs-kernel-server
        state: present
        update_cache: yes

    - name: Crear directorio para media de la cl√≠nica
      file:
        path: /var/www/clinica_media
        state: directory
        owner: nobody
        group: nogroup
        mode: "0775"

    - name: Configurar /etc/exports
      copy:
        dest: /etc/exports
        content: |
          /var/www/clinica_media 10.0.2.0/16(rw,sync,no_subtree_check,no_root_squash)

    - name: Recargar exportfs
      command: exportfs -ra

    - name: Reiniciar servicio NFS
      service:
        name: nfs-kernel-server
        state: restarted
        enabled: yes
