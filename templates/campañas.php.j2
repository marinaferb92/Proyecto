<?php
require_once 'config.php';
require_once 'auth.php';

require_login();
require_role(['admin','recepcionista']);

$pageTitle = "Campañas de marketing";
include 'header.php';

$stmt = $pdo->query("SELECT * FROM CampañasMarketing ORDER BY fecha_inicio DESC");
$campanias = $stmt->fetchAll();
?>

<div class="d-flex justify-content-between mb-3">
    <h3><i class="bi bi-megaphone"></i> Campañas de Marketing</h3>
    <a href="campaña_editar.php" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nueva campaña
    </a>
</div>

<div class="card shadow-sm">
<table class="table table-hover">
<thead>
<tr>
    <th>Nombre</th>
    <th>Canal</th>
    <th>Inicio</th>
    <th>Fin</th>
    <th>Presupuesto</th>
    <th class="text-end">Acciones</th>
</tr>
</thead>

<tbody>
<?php foreach ($campanias as $c): ?>
<tr>
    <td><?=htmlspecialchars($c['nombre'])?></td>
    <td><?=$c['canal']?></td>
    <td><?=$c['fecha_inicio']?></td>
    <td><?=$c['fecha_fin']?></td>
    <td><?=$c['presupuesto']?> €</td>
    <td class="text-end">
        <a href="campaña_editar.php?id=<?=$c['campaña_id']?>" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-pencil"></i>
        </a>
        <a href="campaña_borrar.php?id=<?=$c['campaña_id']?>"
           class="btn btn-sm btn-outline-danger"
           onclick="return confirm('¿Eliminar campaña?')">
            <i class="bi bi-trash"></i>
        </a>
    </td>
</tr>
<?php endforeach; ?>
</tbody>
</table>
</div>

<?php include 'footer.php'; ?>
