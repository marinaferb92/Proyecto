<?php
require "config.php";

if ($_SERVER["REQUEST_METHOD"] === "POST") {

    $user = $_POST["usuario"];
    $pass = $_POST["password"];

    $stmt = $pdo->prepare("SELECT * FROM Usuarios WHERE nombre_usuario = :user AND activo = 1 LIMIT 1");
    $stmt->execute([':user' => $user]);
    $row = $stmt->fetch();

    if ($row && password_verify($pass, $row["password_hash"])) {

        // Crear sesi칩n correcta
        $_SESSION["usuario_id"] = $row["usuario_id"];
        $_SESSION["nombre_usuario"] = $row["nombre_usuario"];
        $_SESSION["rol"] = $row["rol"];

        header("Location: dashboard.php");
        exit;
    }

    $error = "Usuario o contrase침a incorrectos";
}
?>

<?php $pageTitle="Iniciar Sesi칩n"; include "header.php"; ?>
<div class="container col-md-4 mt-5 p-4 shadow bg-white rounded">
    <h3 class="text-center">Acceso</h3>

    <?php if(isset($error)): ?>
        <div class="alert alert-danger text-center"><?= $error ?></div>
    <?php endif; ?>

    <form method="POST">
        <label>Usuario</label>
        <input class="form-control mb-3" type="text" name="usuario" required>

        <label>Contrase침a</label>
        <input class="form-control mb-4" type="password" name="password" required>

        <button class="btn btn-primary w-100">Entrar</button>
    </form>
</div>
<?php include "footer.php"; ?>
