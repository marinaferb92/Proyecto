<?php
require_once 'config.php';
require_once 'auth.php';

require_login();
require_role(['admin']);

$id = (int)($_GET['id'] ?? 0);

$stmt = $pdo->prepare("SELECT COUNT(*) FROM CitaPromocion WHERE promo_id=:id");
$stmt->execute(['id'=>$id]);

if ($stmt->fetchColumn() > 0) {
    header("Location: promociones.php?error=" . urlencode("No se puede eliminar: promociÃ³n aplicada en citas."));
    exit;
}

$pdo->prepare("DELETE FROM DescuentosPromociones WHERE promo_id=:id")->execute(['id'=>$id]);

header("Location: promociones.php?msg=eliminada");
exit;
