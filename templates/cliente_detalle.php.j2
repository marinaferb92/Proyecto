<?php
require_once 'config.php';
require_once 'auth.php';

require_login();
require_role(['admin','recepcionista']);

$id = $_GET['id'] ?? null;

if (!$id) {
    die("ID no proporcionado");
}

// Obtener datos del cliente
$stmt = $pdo->prepare("
    SELECT *
    FROM Clientes
    WHERE cliente_id = ?
");
$stmt->execute([$id]);
$cliente = $stmt->fetch();

if (!$cliente) {
    die("Cliente no encontrado");
}

$pageTitle = "Ficha de " . htmlspecialchars($cliente['nombre']);
include 'header.php';
?>

<h3 class="mb-4">
    <i class="bi bi-person-vcard me-2"></i>Ficha del Cliente
</h3>

<div class="card shadow-sm mb-4">
    <div class="card-body">

        <div class="row mb-3">
            <div class="col-md-6">
                <h5><?= htmlspecialchars($cliente['nombre'].' '.$cliente['apellido']) ?></h5>
                <p class="text-muted m-0"><?= htmlspecialchars($cliente['dni'] ?: "Sin DNI") ?></p>
            </div>

            <div class="col-md-6 text-md-end">
                <a href="cliente_editar.php?id=<?= $cliente['cliente_id'] ?>" class="btn btn-primary">
                    <i class="bi bi-pencil"></i> Editar
                </a>
                <a href="cliente_borrar.php?id=<?= $cliente['cliente_id'] ?>" 
                   onclick="return confirm('¿Eliminar cliente DEFINITIVAMENTE?')"
                   class="btn btn-danger">
                   <i class="bi bi-trash"></i>
                </a>
            </div>
        </div>

        <hr>

        <div class="row mb-3">
            <div class="col-md-4"><strong>Teléfono:</strong> <?= htmlspecialchars($cliente['telefono']) ?></div>
            <div class="col-md-4"><strong>Email:</strong> <?= htmlspecialchars($cliente['correo']) ?></div>
            <div class="col-md-4"><strong>Fecha de registro:</strong> <?= htmlspecialchars($cliente['fecha_registro']) ?></div>
        </div>

        <div class="row mb-3">
            <div class="col-md-4"><strong>Género:</strong> <?= htmlspecialchars($cliente['genero']) ?></div>
            <div class="col-md-4"><strong>Edad:</strong> <?= htmlspecialchars($cliente['edad']) ?></div>
            <div class="col-md-4"><strong>Origen:</strong> <?= htmlspecialchars($cliente['origen_cliente']) ?></div>
        </div>

        <div class="mb-3">
            <strong>Dirección:</strong>  
            <div class="text-muted"><?= nl2br(htmlspecialchars($cliente['direccion'])) ?></div>
        </div>
    </div>
</div>

<?php include 'footer.php'; ?>
